<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>IDV Assignment 5 – Integrated Visualisations</title>
  <style>
    /* 全局页面样式（可以之后再调） */
    body {
      font-family: Arial, sans-serif;
      background: #0f1424;
      color: #fff;
      margin: 20px;
    }

    h1, h2 {
      text-align: center;
    }

    h1 {
      color: #6c5ce7;
      margin-bottom: 5px;
    }

    h2 {
      margin-top: 40px;
      margin-bottom: 10px;
      color: #ffd86b;
    }

    .overview {
      max-width: 900px;
      margin: 0 auto 30px auto;
      background: #1d2a4a;
      padding: 15px 20px;
      border-radius: 8px;
      line-height: 1.6;
      font-size: 14px;
    }

    .assignment-section {
      max-width: 1000px;
      margin: 0 auto 40px auto;
    }

    .assignment-desc {
      font-size: 14px;
      color: #ccc;
      margin-bottom: 10px;
      text-align: left;
    }

    /* —— A1 专属样式 —— */
    #a1-section table {
      width: 100%;
      border-collapse: collapse;
      background: #1d2a4a;
      border-radius: 8px;
      overflow: hidden;
    }

    #a1-section th,
    #a1-section td {
      border: 1px solid #333;
      padding: 8px;
      text-align: center;
      font-size: 13px;
    }

    #a1-section th {
      background: #2e3b5a;
    }

    #a1-section tr:hover {
      background: #2f3c60;
    }

    #a1-update {
      text-align: center;
      margin: 15px 0;
      color: #aaa;
      font-size: 13px;
    }
  </style>
</head>
<body>

  <!-- 顶部 overview（之后可以再改内容） -->
  <h1>IDV Assignment 5 – Integrated Page (A1–A4)</h1>
  <div class="overview">
    <p>
      这个页面整合了我在 IDV 课程中的四次作业（Assignment 1–4），
      统一放在一个网页中展示。每一部分保留了原有的交互和可视化效果。
    </p>
    <p>
      在整合过程中，我需要处理不同作业之间的 HTML 结构、样式（CSS）
      和脚本（JavaScript）冲突，例如重复的 ID、全局样式覆盖等。
      我通过为每个作业划分独立的 section，并给元素添加更具体的选择器，
      来保证它们可以在同一页面正常工作。
    </p>
    <p>
      （后面可以再补：哪个作业最难整合、为什么，以及具体遇到的困难。）
    </p>
  </div>

  <!-- ===== Assignment 1 区域 ===== -->
  <section id="a1-section" class="assignment-section">
    <h2>Assignment 1 – 新加坡空气质量实时监测</h2>
    <div class="assignment-desc">
      使用新加坡政府公开 API 获取 PSI 空气质量数据，
      并将不同指标在各个区域的数值以表格形式实时展示，每分钟自动更新一次。
    </div>

    <div id="a1-update">正在获取数据...</div>
    <table id="a1-data-table">
      <thead>
        <tr>
          <th>指标</th>
          <th>中央</th>
          <th>东部</th>
          <th>西部</th>
          <th>南部</th>
          <th>北部</th>
          <th>全国</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- ===== 这里预留给 A2 / A3 / A4，将来往下加 ===== -->
  <!--
  <section id="a2-section" class="assignment-section">
    ...
  </section>

  <section id="a3-section" class="assignment-section">
    ...
  </section>

  <section id="a4-section" class="assignment-section">
    ...
  </section>
  -->

  <script>
    // A1：新加坡空气质量实时监测
    function setupAssignment1() {
      const labels = {
        "o3_sub_index": "臭氧子指数 (O₃)",
        "pm10_twenty_four_hourly": "PM₁₀ 24小时平均浓度",
        "pm10_sub_index": "PM₁₀ 子指数",
        "co_sub_index": "一氧化碳子指数 (CO)",
        "pm25_twenty_four_hourly": "PM₂.₅ 24小时平均浓度",
        "so2_sub_index": "二氧化硫子指数 (SO₂)",
        "co_eight_hour_max": "一氧化碳8小时最大值",
        "no2_one_hour_max": "二氧化氮1小时最大值 (NO₂)",
        "so2_twenty_four_hourly": "二氧化硫24小时平均浓度",
        "pm25_sub_index": "PM₂.₅ 子指数",
        "psi_twenty_four_hourly": "空气污染指数 (PSI)",
        "o3_eight_hour_max": "臭氧8小时最大值"
      };

      const tbody = document.querySelector("#a1-data-table tbody");
      const update = document.getElementById("a1-update");

      async function loadData() {
        try {
          const res = await fetch("https://api.data.gov.sg/v1/environment/psi");
          const json = await res.json();
          const readings = json.items[0].readings;
          const regions = Object.keys(readings.psi_twenty_four_hourly);

          const time = new Date(json.items[0].update_timestamp)
            .toLocaleString("zh-SG", { timeZone: "Asia/Singapore" });
          update.textContent = `最后更新：${time}`;

          tbody.innerHTML = "";

          for (const key in readings) {
            const row = document.createElement("tr");
            const label = labels[key] || key;
            row.innerHTML =
              `<td>${label}</td>` +
              regions.map(r => `<td>${readings[key][r]}</td>`).join("");
            tbody.appendChild(row);
          }
        } catch (err) {
          console.error(err);
          update.textContent = "数据加载失败，请稍后重试。";
        }
      }

      // 初始化 & 每分钟刷新
      loadData();
      setInterval(loadData, 60000);
    }

    // 页面加载完成后初始化所有作业
    document.addEventListener("DOMContentLoaded", function () {
      setupAssignment1();
      // 后面加：setupAssignment2(); setupAssignment3(); setupAssignment4();
    });
  </script>
</body>
</html>
